<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Imputes outcome and predictor variables that follow an MNAR mechanism
according to Heckman's model and come from a multilevel database such as
individual participant data."><title>Imputation based on Heckman model for multilevel data. — mice.impute.2l.2stage.heckman • miceheckman</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Imputation based on Heckman model for multilevel data. — mice.impute.2l.2stage.heckman"><meta property="og:description" content="Imputes outcome and predictor variables that follow an MNAR mechanism
according to Heckman's model and come from a multilevel database such as
individual participant data."><meta property="og:image" content="https://hanneoberman.github.io/miceheckman/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">miceheckman</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/miceheckman.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Imputation based on Heckman model for multilevel data.</h1>
      
      <div class="d-none name"><code>mice.impute.2l.2stage.heckman.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Imputes outcome and predictor variables that follow an MNAR mechanism
according to Heckman's model and come from a multilevel database such as
individual participant data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mice.impute.2l.2stage.heckman</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">ry</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  wy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">type</span>,</span>
<span>  pmm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ypmm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  meta_method <span class="op">=</span> <span class="st">"reml"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>y</dt>
<dd><p>Vector to be imputed</p></dd>


<dt>ry</dt>
<dd><p>Logical vector of length <code>length(y)</code> indicating the
the subset <code>y[ry]</code> of elements in <code>y</code> to which the imputation
model is fitted. The <code>ry</code> generally distinguishes the observed
(<code>TRUE</code>) and missing values (<code>FALSE</code>) in <code>y</code>.</p></dd>


<dt>x</dt>
<dd><p>Numeric design matrix with <code>length(y)</code> rows with predictors for
<code>y</code>. Matrix <code>x</code> may have no missing values.</p></dd>


<dt>wy</dt>
<dd><p>Logical vector of length <code>length(y)</code>. A <code>TRUE</code> value
indicates locations in <code>y</code> for which imputations are created.</p></dd>


<dt>type</dt>
<dd><p>type of the variable in the prediction model 0: No predictor,
1: Predictor in both the outcome and selection,-2: Cluster id (study id),
-3: Predictor only in the selection model, -4: Predictor only in the outcome
model</p></dd>


<dt>pmm</dt>
<dd><p>predictive mean matching can be applied only for for missing
continuous variables: "FALSE","TRUE"</p></dd>


<dt>ypmm</dt>
<dd><p>vector of donor values of y to perform the predictive mean matching,
in case ypmm is not provided, the observable values of y are used.</p></dd>


<dt>meta_method</dt>
<dd><p>meta_analysis estimation method for random effects :
"ml" (maximum likelihood), "reml" (restricted maximum likelihood) or "mm"
method of moments.</p></dd>


<dt>...</dt>
<dd><p>Other named arguments. Not used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Vector with imputed data, of type binary or continuous</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Imputes systematically and sporadically missing binary and continuous
univariate variables that follow a MNAR mechanism according to the Heckman
selection model and come from a clustered dataset.
The imputation method uses a two-stage approach in which the Heckman model
parameters at the cluster level are estimated using the copula method.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Missing binary variables should be included as two-level factor type variables.
When the cluster variable is not defined in the predictor matrix as "-2", the imputation
method is based on a simple Heckman model, i.e. without taking into account
the hierarchical structure.
In case the Heckman model cannot be estimated at the study level, the imputation
method will be based on the simple Heckman model.
Added:</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Julius Center Methods Group UMC, 2022</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># example code</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘mice’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     cbind, rbind</span>
<span class="r-in"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/make.predictorMatrix.html" class="external-link">make.predictorMatrix</a></span><span class="op">(</span><span class="va">nhanes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pred</span><span class="op">[</span>, <span class="st">"age"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">nhanes</span>, pred <span class="op">=</span> <span class="va">pred</span>, meth <span class="op">=</span> <span class="st">"2l.2stage.heckman"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  iter imp variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   1  bmi</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No group variable has been provided, the Heckman imputation model will be applied globally to the dataset.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The Heckman model cannot be estimated marginally, so systematically missing groups will be imputed with the Heckman model based on the full dataset.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   hyp</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No group variable has been provided, the Heckman imputation model will be applied globally to the dataset.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The Heckman model cannot be estimated marginally, so systematically missing groups will be imputed with the Heckman model based on the full dataset.</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in mice.impute.2l.2stage.heckman(y = c(2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 1, 2, 1, 1, 1, 1, 1), ry = c(`1` = FALSE, `2` = TRUE, `3` = TRUE, `4` = FALSE, `5` = TRUE, `6` = FALSE, `7` = TRUE, `8` = TRUE, `9` = TRUE, `10` = FALSE, `11` = FALSE, `12` = FALSE, `13` = TRUE, `14` = TRUE, `15` = TRUE, `16` = FALSE, `17` = TRUE, `18` = TRUE, `19` = TRUE, `20` = TRUE, `21` = FALSE, `22` = TRUE, `23` = TRUE, `24` = TRUE, `25` = TRUE), x = structure(c(1, 2, 1, 3, 1, 3, 1, 1, 2, 2, 1, 2, 3, 2, 1, 1, 3, 2, 1, 3, 1, 1, 1, 3, 2, -31632.6652863162, 22.7, -52357.3794743866, -64121.0089968081, 20.4, -51517.1201986113, 22.5, 30.1, 22, -57679.0213659062, -31630.9844455429, -66641.78670761, 21.7, 28.7, 29.6, -52077.2930598841, 27.2, 26.3, 35.3, 25.5, -51517.120092814, 33.2, 27.5, 24.9, 27.4, 113, 187, 187, 229, 113, 184, 118, 187, 238, 206, 113, 238, 206, 204, 204, 186, 284, 199, 218, 187, 184, 229, 131, 284, 186), dim = c(25L, 3L), dimnames = list(c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25"), c("age", "bmi", "chl"))),     wy = c(`1` = TRUE, `2` = FALSE, `3` = FALSE, `4` = TRUE,     `5` = FALSE, `6` = TRUE, `7` = FALSE, `8` = FALSE, `9` = FALSE,     `10` = TRUE, `11` = TRUE, `12` = TRUE, `13` = FALSE, `14` = FALSE,     `15` = FALSE, `16` = TRUE, `17` = FALSE, `18` = FALSE, `19` = FALSE,     `20` = FALSE, `21` = TRUE, `22` = FALSE, `23` = FALSE, `24` = FALSE,     `25` = FALSE), type = c(age = -3, bmi = 1, chl = 1)):</span> There is insufficient information to impute the Heckman model at the marginal or study level.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Hanne Oberman, Johanna Muñoz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

